  <!DOCTYPE html>
<html>
    <head>
        <title>Snake Game</title>
    </head>
    <body>
        <canvas id="gameCanvas" width="300" height="300"></canvas> 
        <h1>Scoreboard:</h1>
        <span>Current: </span>
        <span id="currentScore">0</span>
        <br/>
        <span>Max: </span>
        <span id="maxScore">0</span>
        <style>
            #gameCanvas {
                border: 1px solid goldenrod;
            }
        </style>
    </body>
    <script>
        const UNIT_SIZE = 10;
        const TICK_TIME_MS = 300;
        const TICKS_PER_FOOD = 1;
        
        const UP_DIRECTION = 0;
        const RIGHT_DIRECTION = 1;
        const DOWN_DIRECTION = 2;
        const LEFT_DIRECTION = 3;

        let defaultSnake = [
                    {x: 15, y: 15},  
                    {x: 14, y: 15},
                    {x: 13, y: 15},  
                    {x: 12, y: 15},  
                    {x: 11, y: 15},
                    ];
        let snake = defaultSnake.slice();
        let food = [];
        const ctx = gameCanvas.getContext("2d");
        var currentScore = document.getElementById("currentScore"); 
        var maxScore = document.getElementById("maxScore"); 
        let score = 0;
        let ticks = 0;
        document.addEventListener("keydown", changeDirection);
        main();
        
        function main(){
            setTimeout(function onTick() {
                generate_food();
                clearCanvas();
                moveSnake(curr_direction);
                drawSnake();
                drawFood();
                main();
                ticks++;
            }, TICK_TIME_MS);
        }

        function resetGame(){
            if (maxScore.textContent < score)
                maxScore.textContent = score;
            currentScore.textContent = 0;
            score = 0;
            food = [];
            snake = defaultSnake.slice();
        }

        curr_direction = 2;
        function changeDirection(event) {
            const LEFT_KEY = 37;
            const UP_KEY = 38;
            const RIGHT_KEY = 39;
            const DOWN_KEY = 40;
            
            const keyPressed = event.keyCode;

            let directionToGo = 0
            switch (event.keyCode) {
                case UP_KEY:
                    directionToGo = UP_DIRECTION;
                    break;
                case RIGHT_KEY:
                    directionToGo = RIGHT_DIRECTION;
                    break;
                case DOWN_KEY:
                    directionToGo = DOWN_DIRECTION;
                    break;
                case LEFT_KEY:
                    directionToGo = LEFT_DIRECTION;
                    break;
            }
            if (isOppositeDirection(directionToGo))
                return;
            curr_direction = directionToGo;
        }
        function isOppositeDirection(directionToGo){
            return (curr_direction + directionToGo )% 2 ==0;
        }
        function drawSnakePart(snakePart) {
            ctx.fillStyle = 'lightgreen';
            ctx.strokestyle = 'darkgreen';
            ctx.fillRect(snakePart.x*UNIT_SIZE, snakePart.y*UNIT_SIZE, UNIT_SIZE, UNIT_SIZE);
            ctx.strokeRect(snakePart.x*UNIT_SIZE, snakePart.y*UNIT_SIZE, UNIT_SIZE, UNIT_SIZE);
        }
        function drawFoodPart(foodPart){
            ctx.fillStyle = 'red';
            ctx.strokestyle = 'orange';
            ctx.fillRect(foodPart.x*UNIT_SIZE, foodPart.y*UNIT_SIZE, UNIT_SIZE, UNIT_SIZE);
            ctx.strokeRect(foodPart.x*UNIT_SIZE, foodPart.y*UNIT_SIZE, UNIT_SIZE, UNIT_SIZE);
        }
        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.strokestyle = 'white';
            ctx.fillRect(0, 0, 300, 300);
            ctx.strokeRect(0, 0, 300, 300);
        }
        function drawSnake() {
            snake.forEach(drawSnakePart);
        }
        function drawFood() {
            food.forEach(drawFoodPart);
        }
        function moveSnake(curr_direction){
            
            head = snake.pop();
            snake.push({x: head.x, y:head.y})
            let next_x = 0;
            let next_y = 0;

            switch (curr_direction) {
                case 0:
                    next_x = head.x;
                    next_y = head.y-1;
                    break;
                case 1:
                    next_x = head.x+1;
                    next_y = head.y;
                    break;
                case 2:
                    next_x = head.x;
                    next_y = head.y+1;
                    break;
                case 3:
                    next_x = head.x-1;
                    next_y = head.y;
                    break;
            }   
            //outside playtable
            if (next_x > 30 || next_y < 0 || next_y > 30 || next_x <0){
                resetGame();
                return;
            }
            //run into itself
            if (snake.find(function(elem){
                return (elem.x == next_x) && (elem.y == next_y);
            })){
                resetGame();
                return;
            }
            
            //move snake
            snake.push({x: next_x, y: next_y});
            
            //enlarge only if eaten apple
            index_found = food.indexOf(food.find(function(elem){
                return (elem.x == next_x) && (elem.y == next_y);
            }));        
            if(index_found!=-1){
                food.splice(index_found,1);
                score+=1;
                currentScore.textContent = score;
            }
            else
                snake.shift(); 
   
        }
        function isIn(cords, x, y){
            return typeof(cords.find(function(elem){
                return ((elem.x == x) && (elem.y == y))})) 
                !== "undefined";
        }
        function generate_food(){
            if (ticks%TICKS_PER_FOOD)
                return;
            let rand_x = 0;
            let rand_y = 0;
            do{
                rand_x = Math.floor(Math.random() * 30);
                rand_y = Math.floor(Math.random() * 30);                
            } while(isIn(snake, rand_x, rand_y) | isIn(food, rand_x, rand_y))
                
            food.push({x: rand_x, y:rand_y});
        }
    </script>
</html>
